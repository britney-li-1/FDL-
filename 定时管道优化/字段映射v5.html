<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·»åŠ è¡¨ - å¤æ‚æ»šåŠ¨ä¸å¸é™„ç»ˆæç‰ˆ</title>
    <style>
        /* --- 1. åŸºç¡€é‡ç½® --- */
        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            background: rgba(0,0,0,0.6); 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden; 
            color: #333;
        }
        .icon { width: 14px; height: 14px; fill: currentColor; vertical-align: middle; }
        .text-gray { color: #999; }
        .text-blue { color: #1890ff; }
        .bg-blue-light { background-color: #e6f7ff; }
        .bg-green-light { background-color: #f6ffed; }

        /* --- 2. å¼¹çª—å®¹å™¨ (80%) --- */
        .modal-container { 
            width: 80%; 
            height: 80%; 
            background: #fff; 
            border-radius: 4px; 
            box-shadow: 0 8px 30px rgba(0,0,0,0.3); 
            display: flex; 
            flex-direction: column; 
            min-width: 1000px;
        }

        /* --- Global Head --- */
        .modal-sub-header-group { flex-shrink: 0; z-index: 10; background: #fff; }
        .modal-header { height: 50px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; justify-content: space-between; padding: 0 24px; font-size: 16px; font-weight: 500; }
        .close-btn { font-size: 20px; color: #999; cursor: pointer; }
        .steps-bar { height: 44px; background: #fafafa; border-bottom: 1px solid #e8e8e8; display: flex; align-items: center; padding: 0 24px; font-size: 14px; }
        .step-item { display: flex; align-items: center; color: #999; margin-right: 20px; }
        .step-item.active { color: #333; font-weight: 500; }
        .step-badge { width: 20px; height: 20px; background: #1890ff; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; margin-right: 8px; }
        .global-actions-bar { height: 44px; background: #fff; display: flex; align-items: center; justify-content: flex-end; padding: 0 24px; border-bottom: 1px solid #f0f0f0; }
        .global-batch-btn { height: 28px; padding: 0 12px; border: 1px solid #d9d9d9; background: #fff; border-radius: 2px; font-size: 13px; color: #333; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        
        /* --- 3. Body Layout --- */
        .modal-body { 
            flex: 1; 
            display: flex;
            overflow: hidden; 
            position: relative; 
        }

        .sidebar { width: 220px; border-right: 1px solid #f0f0f0; display: flex; flex-direction: column; background: #fff; flex-shrink: 0; }
        .sidebar-search { padding: 12px; border-bottom: 1px solid #f0f0f0; }
        .search-input { width: 100%; height: 30px; border: 1px solid #d9d9d9; border-radius: 2px; padding: 0 8px; }
        .tree-list { flex: 1; overflow-y: auto; padding: 10px 0; }
        .tree-node { padding: 8px 16px; cursor: pointer; font-size: 13px; border-left: 3px solid transparent; }
        .tree-node.active { background: #e6f7ff; color: #1890ff; border-left-color: #1890ff; }
        .resizer { width: 5px; cursor: col-resize; position: absolute; left: 220px; top: 0; bottom: 0; z-index: 10; }

        /* --- 4. Right Content Viewport (Main Scroll) --- */
        /* è¿™æ˜¯å¤–å±‚æ»šåŠ¨çš„è§†å£ */
        .content-viewport {
            flex: 1; 
            overflow-y: auto; 
            background: #fff;
            position: relative;
        }

        .content-padding { padding: 20px 24px 0 24px; }
        .section-title { font-size: 15px; font-weight: bold; margin-bottom: 12px; color: #333; }

        /* --- 5. Table Wrapper --- */
        /* è¿™ä¸ªå®¹å™¨è´Ÿè´£ sticky çš„ä¸Šä¸‹æ–‡ï¼Œå¿…é¡»åŒ…å« Header, Rows å’Œ FooterBar */
        .table-area-wrapper {
            border: 1px solid #e8e8e8;
            background: #fff;
            position: relative;
            /* ä¸è¦è®¾ç½® hiddenï¼Œå¦åˆ™ sticky å¤±æ•ˆ */
        }

        /* Sticky Header */
        .sticky-header {
            position: sticky; top: 0; z-index: 20; background: #fff;
            border-bottom: 1px solid #e8e8e8;
        }
        .toolbar-inner { display: flex; justify-content: space-between; align-items: center; padding: 8px 12px; border-bottom: 1px solid #f9f9f9; }
        .split-header { display: flex; gap: 20px; padding: 8px 12px; }
        .header-box { flex: 1; height: 32px; display: flex; align-items: center; justify-content: space-between; padding: 0 10px; border-radius: 4px; font-size: 12px; font-weight: bold; }
        .box-src { background: #e6f7ff; color: #333; }
        .box-tgt { background: #d9f7be; color: #333; }
        .col-header { display: flex; background: #fafafa; font-size: 12px; color: #666; border-top: 1px solid #e8e8e8;}
        .col-group { flex: 1; display: flex; height: 36px; align-items: center; }
        .col-gap { flex: 0 0 30px; }
        .th-chk { width: 40px; text-align: center; }
        .th-flex { flex: 1; padding-left: 8px; }

        /* --- [æ ¸å¿ƒ] Rows Area (åŒé‡æ»šåŠ¨çš„å…³é”®) --- */
        .rows-area {
            background: #fff;
            overflow-y: auto; 

            /* 1. æœ€å°é«˜åº¦ï¼šç¡®ä¿å°å±ä¸‹å±•ç¤º 9.5 è¡Œ (9.5 * 44px â‰ˆ 420px) 
               å¦‚æœå±å¹•å°ï¼Œè¿™ä¼šæ’‘å¼€å¤–å±‚ viewportï¼Œå¯¼è‡´å¤–å±‚æ»šåŠ¨ */
            min-height: 420px; 
            
            /* 2. æœ€å¤§é«˜åº¦ï¼šå¤§å±è‡ªé€‚åº”ï¼Œéœ²å‡ºåº•éƒ¨ (80vh - çº¦450pxæ‚é¡¹)
               å¦‚æœå±å¹•å¤§ï¼Œmax-height ç”Ÿæ•ˆï¼Œå¯¼è‡´å†…å±‚æ»šåŠ¨ï¼Œéœ²å‡ºä¸‹æ–¹å†™å…¥æ–¹å¼ */
            max-height: calc(80vh - 450px);
            
            /* 3. åº•éƒ¨ Paddingï¼šé˜²æ­¢ Sticky Bar é®æŒ¡æœ€åä¸€è¡Œæ•°æ® */
            padding-bottom: 44px; 
        }

        .table-row { display: flex; height: 44px; border-bottom: 1px solid #e8e8e8; align-items: center; font-size: 13px; }
        .table-row:hover { background: #fafafa; }
        .row-left, .row-right { flex: 1; display: flex; height: 100%; align-items: center; }
        .row-mid { flex: 0 0 30px; display: flex; justify-content: center; align-items: center; color:#ccc;}
        .row-input { height: 24px; width: 92%; border: 1px solid #d9d9d9; border-radius: 2px; padding:0 6px; font-size: 12px; }

        /* --- [æ ¸å¿ƒ] Sticky Footer Overlay --- */
        .sticky-footer-bar {
            /* å¸é™„åœ¨å¯è§†åŒºåŸŸåº•éƒ¨ */
            position: sticky;
            bottom: 0;
            z-index: 30;
            
            height: 44px;
            /* è´Ÿ Marginï¼šè®©å®ƒå‘ä¸Šâ€œæµ®â€åŠ¨ï¼Œç›–åœ¨ rows-area çš„ padding-bottom åŒºåŸŸä¸Š */
            margin-top: -44px;
            
            /* æ ·å¼ */
            background: rgba(255, 255, 255, 0.98);
            border-top: 1px solid #e8e8e8;
            
            display: none; 
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            font-size: 12px;
            
            /* è§†è§‰ä¿®æ­£ */
            box-shadow: 0 -2px 10px rgba(0,0,0,0.02);
            backdrop-filter: blur(2px);
        }

        .sticky-footer-bar.show { display: flex; }

        .bar-left { display: flex; align-items: center; gap: 8px; color: #666; }
        .bar-num { color: #1890ff; font-weight: bold; }
        .bar-clear { cursor: pointer; color: #999; margin-left: 2px; }
        .bar-clear:hover { color: #333; }
        .bar-actions { display: flex; gap: 8px; align-items: center; }
        
        .weak-btn { cursor: pointer; color: #666; transition: all 0.2s; padding: 2px 8px; border-radius: 2px; }
        .weak-btn:hover { color: #1890ff; background: #e6f7ff; }
        .weak-btn.danger:hover { color: #ff4d4f; background: #fff1f0; }
        .divider-v { width: 1px; height: 12px; background: #ddd; }

        /* --- 6. å†™å…¥ config --- */
        .write-config-section { 
            padding: 24px;
            padding-bottom: 40px; 
            /* å®ƒæ˜¯æµå¼å¸ƒå±€ï¼Œåœ¨ Table Wrapper ä¹‹å */
        }
        .bottom-title { font-size: 14px; font-weight: bold; margin-bottom: 12px; color: #333; }
        .cfg-row { display: flex; margin-bottom: 8px; font-size: 13px; }
        .cfg-label { width: 100px; color: #666; }
        .cfg-val { flex: 1; color: #333; display: flex; gap: 8px; flex-wrap: wrap; }
        .pk-tag { display: inline-block; background: #fff; border: 1px solid #ccc; border-radius: 3px; padding: 0 6px; font-size: 12px; margin-right: 6px; }

        /* Footer */
        .modal-footer { height: 60px; border-top: 1px solid #e8e8e8; background: #fff; display: flex; align-items: center; justify-content: flex-end; padding: 0 24px; flex-shrink: 0; z-index: 50; }
        .btn { height: 32px; padding: 0 16px; border: 1px solid #d9d9d9; background: #fff; border-radius: 2px; margin-left: 12px; cursor: pointer; font-size: 14px; }
        .btn:hover { color: #1890ff; border-color: #1890ff; }
        .btn-p { background: #1890ff; color: #fff; border-color: #1890ff; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
    </style>
</head>
<body>

<div class="modal-container">
    <!-- Headers -->
    <div class="modal-sub-header-group">
        <header class="modal-header">
            <span>æ·»åŠ è¡¨</span>
            <span class="close-btn">Ã—</span>
        </header>

        <div class="steps-bar">
            <div class="step-item"><span class="step-badge">1</span> é€‰æ‹©æ¥æºè¡¨</div>
            <span class="step-arrow">>></span>
            <div class="step-item active"><span class="step-badge">2</span> å­—æ®µæ˜ å°„ä¸å†™å…¥</div>
        </div>

        <div class="global-actions-bar">
            <div class="global-batch-btn">å…¨éƒ¨è¡¨æ‰¹é‡æ“ä½œ â–¼</div>
        </div>
    </div>

    <!-- Body -->
    <div class="modal-body">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-search"><input class="search-input" placeholder="æœç´¢è¡¨"></div>
            <div class="tree-list">
                <div class="tree-node active">ğŸ“… å…¥åº“å•æŸ¥è¯¢_å­è¡¨1</div>
                <div class="tree-node">ğŸ“… è´§å“ä»·ç›®è¡¨</div>
            </div>
        </div>
        <div class="resizer" id="resizer"></div>

        <!-- Right Content Viewport (Outer Scroll) -->
        <div class="content-viewport">
            
            <div class="content-padding">
                <div class="section-title">å­—æ®µæ˜ å°„</div>

                <!-- Table Wrapper (Relative Context for Sticky) -->
                <div class="table-area-wrapper">
                    
                    <!-- 1. Header (Sticky Top 0) -->
                    <div class="sticky-header-container">
                        <div class="toolbar-inner">
                            <select style="height:28px; border:1px solid #d9d9d9;"><option>åŒåæ˜ å°„</option></select>
                            <div style="font-size:12px; color:#666; cursor:pointer;">+ æ‰‹åŠ¨å»ºè¡¨ &nbsp; â†» é‡æ–°è·å–</div>
                        </div>
                        <div class="split-header">
                            <div class="header-box box-src">æ¥æº: é‡‡è´­å•æŸ¥è¯¢</div>
                            <div class="header-box box-tgt">ç›®æ ‡: è¡¨ Tabe1</div>
                        </div>
                        <div class="col-header">
                            <div class="col-group" style="background:#f0f7ff; border-right:1px solid #fff;">
                                <div class="th-chk"><input type="checkbox" id="checkAll"></div>
                                <div class="th-flex">æ¥æºå­—æ®µ</div>
                                <div class="th-flex">ç±»å‹</div>
                                <div class="th-sm">ä¸»é”®</div>
                            </div>
                            <div class="col-gap"></div>
                            <div class="col-group" style="background:#f6ffed;">
                                <div class="th-flex">ç›®æ ‡å­—æ®µ</div>
                                <div class="th-flex">ç±»å‹</div>
                                <div class="th-sm">ä¸»é”®</div>
                                <div class="th-op"></div>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Rows (Calc Height logic) -->
                    <div class="rows-area" id="rowContainer">
                        <!-- Content -->
                    </div>

                    <!-- 3. Sticky Bottom Bar (Overlay using negative margin) -->
                    <div class="sticky-footer-bar" id="stickyBar">
                        <div class="bar-left">
                            <span>å·²é€‰ <span class="bar-num" id="selCount">0</span> é¡¹</span>
                            <span class="bar-clear" id="uncheckBtn" title="æ¸…ç©º">Ã—</span>
                        </div>
                        <div class="bar-actions">
                            <div class="weak-btn">æ¢å¤æ˜ å°„</div>
                            <div class="weak-btn">ä¿®æ”¹ç±»å‹</div>
                            <div class="divider-v"></div>
                            <div class="weak-btn danger">å–æ¶ˆæ˜ å°„</div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="write-config-section">
                <!-- è¿™è¡Œæ–‡å­—çº¦åœ¨ 80% éœ²å‡ºçº¿é™„è¿‘ -->
                <div class="bottom-title">å†™å…¥æ–¹å¼</div> 
                <div class="cfg-row">
                    <span class="cfg-label">å†™å…¥æ–¹å¼</span>
                    <span class="cfg-val">ç›´æ¥å°†æ•°æ®å†™å…¥ç›®æ ‡è¡¨</span>
                </div>
                <div class="cfg-row">
                    <span class="cfg-label">ä¸»é”®æ˜ å°„</span>
                    <span class="cfg-val" id="pkContainer"></span>
                </div>
            </div>

        </div>
    </div>

    <footer class="modal-footer">
        <button class="btn">å–æ¶ˆ</button>
        <button class="btn btn-p">ç¡®å®š</button>
    </footer>
</div>

<script>
    // æ¨¡æ‹Ÿæ•°æ® 
    // ç”Ÿæˆè¶³å¤Ÿå¤šçš„è¡Œä»¥æµ‹è¯•é™åˆ¶é€»è¾‘
    const fields = Array.from({length: 30}, (_, i) => ({
        name: `å­—æ®µ_${i+1}`,
        type: i % 2 === 0 ? 'varchar' : 'int',
        key: i < 2
    }));

    const rowContainer = document.getElementById('rowContainer');

    function render() {
        let html = '';
        fields.forEach(f => {
            html += `
            <div class="table-row">
                <div class="row-left">
                    <div class="th-chk"><input type="checkbox" class="row-chk"></div>
                    <div class="th-flex">${f.name}</div>
                    <div class="th-flex text-gray">${f.type}</div>
                    <div class="th-sm">${f.key?'ğŸ”‘':''}</div>
                </div>
                <div class="row-mid">âœ</div>
                <div class="row-right">
                    <div class="th-flex"><input class="row-input" value="${f.name}"></div>
                    <div class="th-flex"><input class="row-input" value="${f.type}"></div>
                    <div class="th-sm"></div>
                    <div class="th-op" style="cursor:pointer; color:#999;">Ã—</div>
                </div>
            </div>`;
        });
        rowContainer.innerHTML = html;
        document.getElementById('pkContainer').innerHTML = fields.filter(f=>f.key).map(f=>`<span class="pk-tag">${f.name}=${f.name}</span>`).join('');
        bindEvents();
    }

    function bindEvents() {
        const checks = document.querySelectorAll('.row-chk');
        const bar = document.getElementById('stickyBar');
        const countSpan = document.getElementById('selCount');
        const checkAll = document.getElementById('checkAll');
        const clearBtn = document.getElementById('uncheckBtn');

        const update = () => {
            const n = Array.from(checks).filter(c=>c.checked).length;
            if (n > 0) {
                bar.classList.add('show');
                countSpan.innerText = n;
            } else {
                bar.classList.remove('show');
            }
            if(checkAll) {
                checkAll.checked = (n === checks.length && n > 0);
                checkAll.indeterminate = (n > 0 && n < checks.length);
            }
        }

        checks.forEach(c => c.addEventListener('change', update));
        if(checkAll) {
            checkAll.addEventListener('change', e => {
                checks.forEach(c => c.checked = e.target.checked);
                update();
            });
        }
        if(clearBtn) {
            clearBtn.addEventListener('click', () => {
                checks.forEach(c => c.checked = false);
                if(checkAll) checkAll.checked = false;
                update();
            });
        }
    }

    const resizer = document.getElementById('resizer');
    const sidebar = document.getElementById('sidebar');
    let r = false;
    resizer.addEventListener('mousedown', () => {r=true; document.body.style.cursor='col-resize'});
    document.addEventListener('mousemove', e => { if(r){ 
        const w = e.clientX - sidebar.parentElement.getBoundingClientRect().left;
        if(w>150 && w<600) sidebar.style.width=w+'px';
    }});
    document.addEventListener('mouseup', () => {r=false; document.body.style.cursor='default'});

    render();
</script>
</body>
</html>