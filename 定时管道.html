<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>帆软数据管道 - 高保真还原</title>
    <!-- 引入 FontAwesome 图标库以还原视觉图标 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #3c78f8;
            --primary-blue-hover: #2960d7;
            --text-main: #303133;
            --text-regular: #606266;
            --text-secondary: #909399;
            --border-color: #ebeef5;
            --bg-body: #f5f7fa;
            --header-height: 50px;
            --sidebar-width: 60px;
            --sub-sidebar-width: 240px;
            --table-border: #e8eaec;
            --hover-bg: #f5f7fa;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- 顶部导航栏 --- */
        .top-header {
            height: var(--header-height);
            background: #fff;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            z-index: 100;
            position: relative;
        }

        .logo-area {
            display: flex;
            align-items: center;
            font-weight: 600;
            font-size: 16px;
            color: var(--text-main);
        }

        .logo-icon {
            background: var(--primary-blue);
            color: white;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            margin-right: 10px;
            font-style: italic;
            font-weight: bold;
        }

        .header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 14px;
            color: var(--text-regular);
        }

        .sys-badge {
            background: #eef2fe;
            color: var(--primary-blue);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- 主体布局 --- */
        .main-layout {
            display: flex;
            flex: 1;
            height: calc(100vh - var(--header-height));
        }

        /* 左侧一级导航 (Icon Bar) */
        .icon-sidebar {
            width: var(--sidebar-width);
            background: #fff;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 10px;
        }

        .nav-item {
            width: 40px;
            height: 48px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-regular);
            font-size: 10px;
            cursor: pointer;
            border-radius: 4px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .nav-item i {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .nav-item:hover {
            color: var(--primary-blue);
        }

        .nav-item.active {
            color: var(--primary-blue);
            background: #ecf5ff;
        }

        /* 左侧二级导航 (Tree View) */
        .tree-sidebar {
            width: var(--sub-sidebar-width);
            background: #fff;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            padding: 16px;
        }

        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-new {
            background: var(--primary-blue);
            color: white;
            border: none;
            padding: 5px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .search-box {
            position: relative;
            margin-bottom: 16px;
        }

        .search-box input {
            width: 100%;
            padding: 6px 30px 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 12px;
            outline: none;
        }

        .search-box i {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .tree-list {
            list-style: none;
            overflow-y: auto;
            flex: 1;
        }

        .tree-node {
            display: flex;
            align-items: center;
            padding: 8px 0;
            font-size: 13px;
            color: var(--text-regular);
            cursor: pointer;
            border-radius: 2px;
        }
        
        .tree-node:hover {
            background-color: #f5f7fa;
        }

        .tree-node.active {
            background-color: #ebf3ff;
            color: var(--primary-blue);
            font-weight: 500;
            border-right: 2px solid var(--primary-blue);
        }

        .indent-1 { padding-left: 0px; }
        .indent-2 { padding-left: 20px; }
        .indent-3 { padding-left: 40px; }

        .tree-icon {
            margin-right: 6px;
            width: 14px;
            text-align: center;
        }
        .folder-icon { color: #fcc02e; }
        .file-icon { color: #7f95d1; } /* Blueish file icon */

        /* --- 右侧主内容区 --- */
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #fff;
        }

        .content-header {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        /* 面包屑/标题行 */
        .page-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .page-breadcrumb {
            display: flex;
            align-items: center;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
            gap: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn-outline {
            border: 1px solid #dcdfe6;
            background: #fff;
            color: var(--text-regular);
            padding: 6px 15px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* 任务信息区块 */
        .task-meta {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .task-meta span { margin-right: 20px; }

        .flow-card {
            background: #f8f9fb;
            border: 1px solid #ebeef5;
            border-radius: 6px;
            padding: 16px;
            position: relative;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 13px;
        }
        
        .db-tag {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .arrow-divider {
            color: var(--primary-blue);
            font-size: 20px;
            margin: 0 10px;
            display: flex;
            align-items: center;
        }
        
        .edit-pen {
            position: absolute;
            top: 16px;
            right: 16px;
            color: var(--text-secondary);
            cursor: pointer;
            border: 1px solid #dcdfe6;
            padding: 6px;
            border-radius: 4px;
            background: #fff;
        }
        
        .more-info-toggle {
            margin-top: 10px;
            font-size: 12px;
            color: var(--text-regular);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Tab 栏 */
        .tabs-nav {
            display: flex;
            padding: 0 24px;
            border-bottom: 1px solid var(--border-color);
            margin-top: 5px;
        }

        .tab-item {
            padding: 12px 0;
            margin-right: 30px;
            font-size: 13px;
            cursor: pointer;
            color: var(--text-regular);
            position: relative;
        }

        .tab-item.active {
            color: var(--primary-blue);
            font-weight: 500;
        }

        .tab-item.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary-blue);
        }

        /* 工具栏 */
        .toolbar {
            padding: 12px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn-add {
            background: #eef4ff;
            color: var(--primary-blue);
            border: none;
            padding: 6px 12px;
            border-radius: 2px;
            font-size: 13px;
            cursor: pointer;
        }

        .right-tools {
            display: flex;
            align-items: center;
            gap: 16px;
            color: var(--text-regular);
        }

        /* --- 高保真表格 (Sticky Columns) --- */
        .table-container {
            flex: 1;
            overflow: auto; /* 允许滚动 */
            padding: 0 24px 24px 24px;
            margin-bottom: 24px;
        }

        .data-table {
            width: 100%;
            border-collapse: separate; /* 用于sticky效果 */
            border-spacing: 0;
            font-size: 12px;
            color: var(--text-main);
            min-width: 1200px; /* 强制横向滚动 */
        }

        .data-table th {
            background: #f5f7fa;
            color: var(--text-regular);
            font-weight: 500;
            text-align: left;
            padding: 10px 12px;
            border-bottom: 1px solid var(--table-border);
            border-top: 1px solid var(--table-border);
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10; /* Header Z-index */
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid var(--table-border);
            background: #fff;
            white-space: nowrap;
        }

        .data-table tr:hover td {
            background: var(--hover-bg);
        }

        /* 冻结列样式 */
        .sticky-col-left {
            position: sticky;
            left: 0;
            z-index: 2;
            background: #fff; /* 防止透明 */
            border-right: 1px solid transparent; 
        }
        
        .sticky-col-right {
            position: sticky;
            right: 0;
            z-index: 2;
            background: #fff;
            text-align: center;
            width: 100px;
        }

        /* 表头也需要冻结 */
        th.sticky-col-left {
            z-index: 11;
            background: #f5f7fa;
        }
        th.sticky-col-right {
            z-index: 11;
            background: #f5f7fa;
        }

        /* 滚动时的阴影效果 (通过JS添加类名或纯CSS的技巧) */
        /* CSS Trick: Masking or simplified logical borders */
        .sticky-col-left::after {
            content: "";
            position: absolute;
            top: 0;
            right: -5px;
            bottom: 0;
            width: 5px;
            pointer-events: none;
            box-shadow: inset 5px 0 5px -5px rgba(0,0,0,0.1);
        }
        
        .sticky-col-right::before {
            content: "";
            position: absolute;
            top: 0;
            left: -5px;
            bottom: 0;
            width: 5px;
            pointer-events: none;
            box-shadow: inset -5px 0 5px -5px rgba(0,0,0,0.1);
        }

        /* 表格内部元素样式 */
        .cell-checkbox {
            margin-right: 8px;
            vertical-align: middle;
            width: 14px;
            height: 14px;
            border: 1px solid #dcdfe6;
            border-radius: 2px;
            cursor: pointer;
            display: inline-block;
            position: relative;
        }
        /* 模拟选中状态 */
        .cell-checkbox.checked::after {
            content: '\2713';
            font-size: 10px;
            color: white;
            background: var(--primary-blue);
            position: absolute;
            top: -1px; left: -1px; right: -1px; bottom: -1px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1px;
        }

        .row-group-title {
            background: #fff;
            font-weight: 500;
            color: var(--text-main);
        }
        
        /* Expand Icon */
        .expand-icon {
            font-size: 10px;
            color: var(--text-regular);
            margin-right: 5px;
            width: 12px;
            display: inline-block;
        }

        .info-circle {
            color: var(--text-secondary);
            margin-left: 4px;
            cursor: help;
        }

        .action-icon {
            color: var(--text-regular);
            margin: 0 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .action-icon:hover {
            color: var(--primary-blue);
        }
        .icon-edit { color: var(--text-regular); }
        .icon-play { color: var(--text-regular); }
        .icon-delete { color: var(--text-regular); }

        .link-text {
            color: var(--primary-blue);
            text-decoration: none;
            cursor: pointer;
        }

        /* 树形子表连接线 L型 */
        .sub-row td.sticky-col-left {
            padding-left: 40px; /* Base indent */
            position: sticky;
        }
        .sub-indicator {
            display: inline-block;
            width: 15px;
            height: 25px;
            border-left: 1px solid #dcdfe6;
            border-bottom: 1px solid #dcdfe6;
            margin-right: 8px;
            vertical-align: top;
            margin-top: -12px; /* Pull up to connect to prev row */
            position: relative;
            top: 2px;
        }
        
        /* Footer info */
        .footer-info {
            font-size: 12px;
            color: var(--text-secondary);
            padding: 10px 24px;
        }

        /* --- 添加表弹窗样式 --- */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-dialog {
            background: #fff;
            border-radius: 4px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .modal-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-main);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            color: var(--text-main);
        }

        .modal-steps {
            padding: 12px 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .step-item {
            color: var(--text-regular);
            padding: 4px 12px;
            border-radius: 4px;
        }

        .step-item.active {
            color: var(--primary-blue);
            background: #ecf5ff;
        }

        .step-divider {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .modal-body {
            flex: 1;
            display: flex;
            overflow: hidden;
            min-height: 500px;
        }

        .modal-left-panel {
            width: 400px;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            background: #fafafa;
        }

        .modal-right-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #fff;
        }

        .panel-title {
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-main);
            border-bottom: 1px solid var(--border-color);
        }

        .panel-search {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .panel-search input {
            width: 100%;
            padding: 6px 30px 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 12px;
            outline: none;
        }

        .panel-search .search-icon {
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px;
        }

        .table-tree {
            list-style: none;
        }

        .tree-category {
            margin-bottom: 8px;
        }

        .tree-category-header {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-main);
            user-select: none;
        }

        .tree-category-header:hover {
            background: #f0f0f0;
        }

        .tree-category-icon {
            width: 16px;
            margin-right: 6px;
            color: var(--text-secondary);
            font-size: 10px;
        }

        .tree-category-children {
            margin-left: 22px;
            display: none;
        }

        .tree-category.expanded .tree-category-children {
            display: block;
        }

        .tree-item {
            display: flex;
            align-items: center;
            padding: 6px 8px;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-regular);
            border-radius: 2px;
        }

        .tree-item:hover {
            background: #f0f0f0;
        }

        .tree-checkbox {
            width: 14px;
            height: 14px;
            border: 1px solid #dcdfe6;
            border-radius: 2px;
            margin-right: 8px;
            cursor: pointer;
            position: relative;
            flex-shrink: 0;
        }

        .tree-checkbox.checked {
            background: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .tree-checkbox.checked::after {
            content: '\2713';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 10px;
        }

        .tree-item-name {
            flex: 1;
        }

        .tree-item-badge {
            font-size: 11px;
            color: var(--text-secondary);
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 2px;
            margin-left: 8px;
        }

        .selected-table-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .batch-action-bar {
            display: none;
            padding: 12px 16px;
            background: #ecf5ff;
            border-bottom: 1px solid var(--border-color);
            align-items: center;
            gap: 12px;
            font-size: 13px;
        }

        .batch-action-bar.show {
            display: flex;
        }

        .batch-selection-info {
            color: var(--primary-blue);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .batch-close {
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 16px;
            padding: 2px 4px;
        }

        .batch-close:hover {
            color: var(--text-main);
        }

        .batch-divider {
            width: 1px;
            height: 16px;
            background: #dcdfe6;
        }

        .batch-actions {
            display: flex;
            gap: 16px;
            margin-left: auto;
        }

        .batch-action-btn {
            color: var(--primary-blue);
            cursor: pointer;
            font-size: 13px;
            padding: 4px 0;
            position: relative;
        }

        .batch-action-btn:hover {
            text-decoration: underline;
        }

        .batch-action-btn.disabled {
            color: #c0c4cc;
            cursor: not-allowed;
        }

        .batch-action-btn.disabled:hover {
            text-decoration: none;
        }

        .batch-action-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 8px;
            padding: 6px 10px;
            background: rgba(0, 0, 0, 0.75);
            color: white;
            font-size: 12px;
            border-radius: 4px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            z-index: 1000;
        }

        .batch-action-btn.disabled:hover .batch-action-tooltip {
            opacity: 1;
        }

        .batch-action-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 4px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.75);
        }

        .table-wrapper {
            flex: 1;
            overflow-y: auto;
        }

        .selected-table-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            font-size: 13px;
        }

        .selected-table-empty i {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        .selected-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        .selected-table thead {
            background: #f5f7fa;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .selected-table th {
            padding: 10px 12px;
            text-align: left;
            font-weight: 500;
            color: var(--text-regular);
            border-bottom: 1px solid var(--border-color);
            white-space: nowrap;
        }

        .selected-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border-color);
        }

        .selected-table tbody tr:hover {
            background: var(--hover-bg);
        }

        .category-group {
            background: #fff;
        }

        .category-group-header {
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-main);
            background: #f5f7fa;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .category-group-header .expand-icon {
            margin-right: 6px;
            font-size: 10px;
            color: var(--text-regular);
            transition: transform 0.2s;
        }

        .category-group.expanded .category-group-header .expand-icon {
            transform: rotate(90deg);
        }

        .category-group-rows {
            display: none;
        }

        .category-group.expanded .category-group-rows {
            display: table-row-group;
        }

        /* 分类行样式 */
        .category-row {
            background: #fff;
        }

        .category-row td {
            padding: 6px 12px;
            background: #fff;
        }

        .category-row td:first-child {
            width: 40px;
            padding: 6px 12px;
        }

        .category-row .category-label {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-main);
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            user-select: none;
        }

        .category-row .category-label:hover {
            color: var(--primary-blue);
        }

        .category-row .category-label .expand-icon {
            font-size: 10px;
            color: var(--text-regular);
            transition: transform 0.2s;
        }

        .category-row.expanded .category-label .expand-icon {
            transform: rotate(90deg);
        }

        .selected-row {
            position: relative;
        }

        .selected-row.sub-row {
            background: #fafafa;
        }

        .selected-row.sub-row td:first-child {
            position: relative;
        }

        .sub-indicator-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 50%;
            width: 1px;
            background: #dcdfe6;
        }

        .sub-indicator-line::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 15px;
            height: 1px;
            background: #dcdfe6;
        }

        .sub-table-toggle {
            color: var(--primary-blue);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
        }

        .sub-table-toggle:hover {
            text-decoration: underline;
        }

        .sub-table-toggle i {
            font-size: 10px;
        }

        .sync-start-input {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .sync-start-input input {
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 12px;
            width: 160px;
        }

        .delete-btn {
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 14px;
        }

        .delete-btn:hover {
            color: #f56c6c;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .btn-cancel {
            background: #fff;
            border: 1px solid #dcdfe6;
            color: var(--text-regular);
            padding: 8px 20px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }

        .btn-cancel:hover {
            color: var(--primary-blue);
            border-color: var(--primary-blue);
        }

        .btn-next {
            background: var(--primary-blue);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }

        .btn-next:hover {
            background: var(--primary-blue-hover);
        }

    </style>
</head>
<body>

    <!-- 顶部导航 -->
    <header class="top-header">
        <div class="logo-area">
            <div class="logo-icon">F</div>
            帆软软件有限公司
        </div>
        <div class="header-right">
            <div class="sys-badge">
                <i class="fa-solid fa-cube"></i> 管理系统 <i class="fa-solid fa-caret-down"></i>
            </div>
            <i class="fa-regular fa-bell"></i>
            <i class="fa-regular fa-circle-question"></i>
            <div class="user-profile">
                <i class="fa-solid fa-user"></i> 用户名 <i class="fa-solid fa-caret-down"></i>
            </div>
        </div>
    </header>

    <div class="main-layout">
        <!-- 侧边栏一级 -->
        <aside class="icon-sidebar">
            <div class="nav-item"><i class="fa-solid fa-layer-group"></i>运维中心</div>
            <div class="nav-item active"><i class="fa-solid fa-route"></i>数据管道</div>
            <div class="nav-item"><i class="fa-solid fa-code"></i>数据开发</div>
            <div class="nav-item"><i class="fa-solid fa-database"></i>数据服务</div>
            <div class="nav-item"><i class="fa-solid fa-server"></i>数据管理</div>
            <div style="margin-top: auto; margin-bottom: 20px;">
                <div class="nav-item"><i class="fa-solid fa-angles-right"></i></div>
            </div>
        </aside>

        <!-- 侧边栏二级 -->
        <aside class="tree-sidebar">
            <div class="sidebar-title">
                定时管道
                <button class="btn-new"><i class="fa-solid fa-plus"></i> 新建</button>
            </div>
            <div class="search-box">
                <input type="text" placeholder="搜索任务/文件夹">
                <i class="fa-solid fa-magnifying-glass"></i>
                <i class="fa-solid fa-rotate" style="right: -25px; cursor: pointer;"></i>
            </div>
            <ul class="tree-list">
                <li class="tree-node indent-1"><i class="fa-solid fa-caret-down tree-icon"></i> <i class="fa-regular fa-folder folder-icon tree-icon"></i> 所有的任务</li>
                <li class="tree-node indent-2"><i class="fa-solid fa-caret-down tree-icon"></i> <i class="fa-regular fa-folder folder-icon tree-icon"></i> 文件夹1</li>
                <li class="tree-node indent-3"><i class="fa-solid fa-caret-right tree-icon"></i> <i class="fa-regular fa-folder folder-icon tree-icon"></i> 文件夹2</li>
                <li class="tree-node indent-3"><i class="fa-solid fa-caret-down tree-icon"></i> <i class="fa-regular fa-folder folder-icon tree-icon"></i> 文件夹3</li>
                <li class="tree-node indent-3 active" style="padding-left: 60px;"><i class="fa-regular fa-file-code file-icon tree-icon"></i> 任务1</li>
                <li class="tree-node indent-3" style="padding-left: 60px;"><i class="fa-regular fa-file-code file-icon tree-icon"></i> 任务2</li>
                <li class="tree-node indent-3" style="padding-left: 60px;"><i class="fa-regular fa-file-code file-icon tree-icon"></i> 任务3</li>
                <li class="tree-node indent-3"><i class="fa-solid fa-caret-right tree-icon"></i> <i class="fa-regular fa-folder folder-icon tree-icon"></i> 文件夹4</li>
                <li class="tree-node indent-2"><i class="fa-solid fa-caret-right tree-icon"></i> <i class="fa-regular fa-folder folder-icon tree-icon"></i> 文件夹7</li>
            </ul>
        </aside>

        <!-- 内容区域 -->
        <main class="content-area">
            <div class="content-header">
                <div class="page-title-row">
                    <div class="page-breadcrumb">
                        <i class="fa-regular fa-rectangle-list" style="color: #3c78f8;"></i> 定时管道任务1
                    </div>
                    <div class="action-buttons">
                        <button class="btn-outline"><i class="fa-solid fa-sliders"></i> 任务控制</button>
                        <button class="btn-outline"><i class="fa-regular fa-clock"></i> 定时调度</button>
                    </div>
                </div>
                
                <div class="task-meta">
                    <span>创建人：Lana</span>
                    <span>创建时间：2023-03-02 12:10:10</span>
                    <span>定时调度：<span style="border-bottom: 1px dashed #999;">未配置</span></span>
                </div>
                <div class="task-meta">
                    描述：描述文案描述文案描述文案描述文案描述文案描述文案描述文案...
                </div>

                <div class="flow-card">
                    <i class="fa-solid fa-pen edit-pen"></i>
                    <div class="flow-diagram">
                        <div class="db-tag">
                            <i class="fa-solid fa-database" style="color:#5cb6ff;"></i>
                            客客云 · <strong>_5.175数据连接</strong>
                        </div>
                        <div class="arrow-divider">
                            <i class="fa-solid fa-arrow-right-long"></i>
                        </div>
                        <div class="db-tag">
                            <i class="fa-solid fa-seedling" style="color:#5ccebd;"></i>
                            MySQL · <strong>MySQL</strong> (default)
                        </div>
                    </div>
                    <div class="more-info-toggle">
                        <i class="fa-solid fa-caret-down"></i> 更多信息
                    </div>
                    <div style="margin-top: 8px; font-size: 13px; color: #606266;">
                        同步源表结构变化： 已开启
                    </div>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-nav">
                <div class="tab-item active">同步配置</div>
                <div class="tab-item">运行记录</div>
            </div>

            <!-- Toolbar -->
            <div class="toolbar">
                <button class="btn-add" id="btnAddTable"><i class="fa-solid fa-circle-plus"></i> 添加表</button>
                <div class="right-tools">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <span style="font-size: 13px;"><i class="fa-regular fa-circle-play"></i> 运行所有表</span>
                </div>
            </div>

            <!-- Table Container (Scrollable) -->
            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th class="sticky-col-left" style="min-width: 280px; box-shadow: 2px 0 5px -2px rgba(0,0,0,0.1);">
                                <div class="cell-checkbox"></div> 来源表
                            </th>
                            <th style="min-width: 100px;">表类型 <i class="fa-solid fa-filter" style="font-size:10px; color:#909399;"></i></th>
                            <th style="min-width: 200px;">目标表</th>
                            <th style="min-width: 120px;">写入方式</th>
                            <th style="min-width: 160px;">当前断点(下次起点) <i class="fa-regular fa-circle-question info-circle"></i></th>
                            <th style="min-width: 160px;">首次同步起点 <i class="fa-regular fa-circle-question info-circle"></i></th>
                            <th style="min-width: 120px;">今日调用余量</th>
                            <th class="sticky-col-right" style="box-shadow: -2px 0 5px -2px rgba(0,0,0,0.1);">
                                <i class="fa-solid fa-gear"></i>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 分类 1 -->
                        <tr class="group-row">
                            <td colspan="8" class="sticky-col-left" style="background:#fff; z-index: 5;">
                                <i class="fa-solid fa-caret-down expand-icon"></i> 分类：基础类
                            </td>
                        </tr>
                        <!-- 行 1 -->
                        <tr>
                            <td class="sticky-col-left">
                                <div class="cell-checkbox"></div>
                                <span style="margin-right:4px;">店铺查询</span>
                                <i class="fa-regular fa-circle-question info-circle"></i>
                            </td>
                            <td>全量表</td>
                            <td>店铺查询</td>
                            <td>清空目标表，再写入数据 <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td>--</td>
                            <td>全量表，无需配置</td>
                            <td><span class="link-text">查看</span></td>
                            <td class="sticky-col-right">
                                <i class="fa-solid fa-pen action-icon icon-edit" style="color:#f56c6c;"></i> <!-- Red edit icon per image -->
                                <i class="fa-regular fa-circle-play action-icon icon-play"></i>
                                <i class="fa-regular fa-trash-can action-icon icon-delete"></i>
                            </td>
                        </tr>
                        <!-- 行 2 -->
                        <tr>
                            <td class="sticky-col-left">
                                <div class="cell-checkbox"></div>
                                <span style="margin-right:4px;">仓库查询</span>
                                <i class="fa-regular fa-circle-question info-circle"></i>
                            </td>
                            <td>全量表</td>
                            <td>仓库查询</td>
                            <td>清空目标表，再写入数据 <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td>--</td>
                            <td>全量表，无需配置</td>
                            <td><span class="link-text">查看</span></td>
                            <td class="sticky-col-right">
                                <i class="fa-solid fa-pen action-icon icon-edit" style="color:#f56c6c;"></i>
                                <i class="fa-regular fa-circle-play action-icon icon-play"></i>
                                <i class="fa-regular fa-trash-can action-icon icon-delete"></i>
                            </td>
                        </tr>

                        <!-- 分类 2 -->
                        <tr class="group-row">
                            <td colspan="8" class="sticky-col-left" style="background:#fff; z-index: 5;">
                                <i class="fa-solid fa-caret-down expand-icon"></i> 分类：库存类
                            </td>
                        </tr>
                        <!-- 行 3 -->
                        <tr>
                            <td class="sticky-col-left">
                                <div class="cell-checkbox"></div>
                                <span style="margin-right:4px;">盘点入库单查询</span>
                                <i class="fa-regular fa-circle-question info-circle"></i>
                            </td>
                            <td>全量表</td>
                            <td>盘点入库单查询</td>
                            <td>清空目标表，再写入数据 <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td>--</td>
                            <td>全量表，无需配置</td>
                            <td><span class="link-text">查看</span></td>
                            <td class="sticky-col-right">
                                <i class="fa-solid fa-pen action-icon icon-edit"></i>
                                <i class="fa-regular fa-circle-play action-icon icon-play"></i>
                                <i class="fa-regular fa-trash-can action-icon icon-delete"></i>
                            </td>
                        </tr>
                        <!-- 行 3 子表 -->
                        <tr class="sub-row">
                            <td class="sticky-col-left">
                                <span class="sub-indicator"></span>
                                货品档案查询_单品信息详情
                            </td>
                            <td>全量子表</td>
                            <td>货品档案查询_单品信息详情</td>
                            <td>清空目标表，再等值更新 <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td style="color:#909399;">跟随主表</td>
                            <td style="color:#909399;">跟随主表</td>
                            <td style="color:#909399;">跟随主表</td>
                            <td class="sticky-col-right">
                                <i class="fa-solid fa-pen action-icon icon-edit"></i>
                            </td>
                        </tr>

                        <!-- 行 4 -->
                        <tr>
                            <td class="sticky-col-left">
                                <div class="cell-checkbox"></div>
                                <span style="margin-right:4px;">入库瞬时成本查询</span>
                                <i class="fa-regular fa-circle-question info-circle"></i>
                            </td>
                            <td>增量表</td>
                            <td>入库瞬时成本查询</td>
                            <td>直接将数据写入目标表 <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td>2025-11-24 11:20:30 <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td>2024-3-22 12:10:10</td>
                            <td><span class="link-text">查看</span></td>
                            <td class="sticky-col-right">
                                <i class="fa-solid fa-pen action-icon icon-edit"></i>
                                <i class="fa-regular fa-circle-play action-icon icon-play"></i>
                                <i class="fa-regular fa-trash-can action-icon icon-delete"></i>
                            </td>
                        </tr>
                        <!-- 行 4 子表 -->
                        <tr class="sub-row">
                            <td class="sticky-col-left">
                                <span class="sub-indicator"></span>
                                入库瞬时成本查询_明细
                            </td>
                            <td>增量子表</td>
                            <td>入库瞬时成本查询_明细</td>
                            <td>等值更新：基于等值字段的... <i class="fa-regular fa-circle-question info-circle"></i></td>
                            <td style="color:#909399;">跟随主表</td>
                            <td style="color:#909399;">跟随主表</td>
                            <td style="color:#909399;">跟随主表</td>
                            <td class="sticky-col-right">
                                <i class="fa-solid fa-pen action-icon icon-edit"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- 底部统计 -->
            <div class="footer-info">
                已添加 6 张表，其中有4张主表、2张子表
            </div>

        </main>
    </div>

    <!-- 添加表弹窗 -->
    <div class="modal-overlay" id="addTableModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <div class="modal-title">添加表</div>
                <button class="modal-close" id="closeModal">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>
            <div class="modal-steps">
                <div class="step-item active">1 来源表处理</div>
                <i class="fa-solid fa-angles-right step-divider"></i>
                <div class="step-item">2 字段映射与写入</div>
            </div>
            <div class="modal-body">
                <!-- 左侧：选择表 -->
                <div class="modal-left-panel">
                    <div class="panel-title">选择表</div>
                    <div class="panel-search" style="position: relative;">
                        <input type="text" placeholder="搜索库/表" id="tableSearch">
                        <i class="fa-solid fa-magnifying-glass search-icon"></i>
                    </div>
                    <div class="panel-content">
                        <ul class="table-tree" id="tableTree">
                            <!-- 基础类 -->
                            <li class="tree-category expanded">
                                <div class="tree-category-header">
                                    <i class="fa-solid fa-caret-down tree-category-icon"></i>
                                    <span>基础类</span>
                                </div>
                                <ul class="tree-category-children">
                                    <li class="tree-item" data-table="仓库查询" data-type="全量表" data-category="基础类">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">仓库查询</span>
                                        <span class="tree-item-badge">全量表</span>
                                    </li>
                                    <li class="tree-item" data-table="店铺查询" data-type="全量表" data-category="基础类">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">店铺查询</span>
                                        <span class="tree-item-badge">全量表</span>
                                    </li>
                                    <li class="tree-item" data-table="供应商查询" data-type="增量表" data-category="基础类" data-has-sub="false">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">供应商查询</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                    <li class="tree-item" data-table="分销商查询" data-type="增量表" data-category="基础类">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">分销商查询</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                    <li class="tree-item" data-table="入库单查询" data-type="增量表" data-category="基础类" data-has-sub="true" data-sub-name="入库单查询-明细">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">入库单查询</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                    <li class="tree-item" data-table="货品价目表" data-type="增量表" data-category="基础类" data-has-sub="false">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">货品价目表</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                </ul>
                            </li>
                            <!-- 入库类 -->
                            <li class="tree-category">
                                <div class="tree-category-header">
                                    <i class="fa-solid fa-caret-right tree-category-icon"></i>
                                    <span>入库类</span>
                                </div>
                                <ul class="tree-category-children">
                                    <li class="tree-item" data-table="采购入库" data-type="增量表" data-category="入库类">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">采购入库</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                    <li class="tree-item" data-table="退货入库" data-type="增量表" data-category="入库类">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">退货入库</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                    <li class="tree-item" data-table="物流入库" data-type="增量表" data-category="入库类">
                                        <div class="tree-checkbox"></div>
                                        <span class="tree-item-name">物流入库</span>
                                        <span class="tree-item-badge">增量表</span>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- 右侧：处理表 -->
                <div class="modal-right-panel">
                    <div class="panel-title">处理表</div>
                    <!-- 批量操作栏 -->
                    <div class="batch-action-bar" id="batchActionBar">
                        <div class="batch-selection-info">
                            <span>已选择 <span id="selectedCount">0</span>/<span id="totalCount">0</span></span>
                            <i class="fa-solid fa-xmark batch-close" id="batchClose"></i>
                        </div>
                        <div class="batch-divider"></div>
                        <div class="batch-actions">
                            <span class="batch-action-btn" id="batchSyncStart">
                                首次同步起点
                                <span class="batch-action-tooltip">全量表无需配置</span>
                            </span>
                            <span class="batch-action-btn" id="batchSubTable">
                                子表处理
                                <span class="batch-action-tooltip">不存在子表</span>
                            </span>
                            <span class="batch-action-btn" id="batchDelete">批量删除</span>
                        </div>
                    </div>
                    <div class="selected-table-container" id="selectedTableContainer">
                        <!-- 空状态 -->
                        <div class="selected-table-empty" id="emptyState">
                            <i class="fa-regular fa-inbox"></i>
                            <div>暂无已选表，请在左侧勾选表</div>
                        </div>
                        <!-- 已选表列表 -->
                        <div class="table-wrapper" id="tableWrapper" style="display: none;">
                            <table class="selected-table" id="selectedTable">
                                <thead>
                                    <tr>
                                        <th style="width: 40px;">
                                            <div class="tree-checkbox" id="selectAllCheckbox"></div>
                                        </th>
                                        <th style="min-width: 200px;">来源表</th>
                                        <th style="min-width: 100px;">表类型 <i class="fa-solid fa-filter" style="font-size:10px; color:#909399;"></i></th>
                                        <th style="min-width: 200px;">同步起点</th>
                                        <th style="min-width: 150px;">子表处理</th>
                                        <th style="width: 60px;"></th>
                                    </tr>
                                </thead>
                                <tbody id="selectedTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="btnCancel">取消</button>
                <button class="btn-next" id="btnNext">下一步</button>
            </div>
        </div>
    </div>

    <script>
        // 简单的交互逻辑：侧边栏点击高亮
        document.querySelectorAll('.tree-node').forEach(node => {
            node.addEventListener('click', function(e) {
                // 阻止事件冒泡防止父级触发
                e.stopPropagation();
                // 移除其他激活状态
                document.querySelectorAll('.tree-node').forEach(n => n.classList.remove('active'));
                // 激活当前
                this.classList.add('active');
            });
        });

        // Tab 切换逻辑
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // 复选框点击效果
        document.querySelectorAll('.cell-checkbox').forEach(box => {
            box.addEventListener('click', function(e) {
                e.stopPropagation();
                this.classList.toggle('checked');
            });
        });

        // ========== 添加表弹窗逻辑 ==========
        const modal = document.getElementById('addTableModal');
        const btnAddTable = document.getElementById('btnAddTable');
        const closeModal = document.getElementById('closeModal');
        const btnCancel = document.getElementById('btnCancel');
        const selectedTableContainer = document.getElementById('selectedTableContainer');
        const emptyState = document.getElementById('emptyState');
        const tableWrapper = document.getElementById('tableWrapper');
        const selectedTable = document.getElementById('selectedTable');
        const selectedTableBody = document.getElementById('selectedTableBody');
        const selectAllCheckbox = document.getElementById('selectAllCheckbox');
        const batchActionBar = document.getElementById('batchActionBar');
        const selectedCount = document.getElementById('selectedCount');
        const totalCount = document.getElementById('totalCount');
        const batchClose = document.getElementById('batchClose');
        const batchSyncStart = document.getElementById('batchSyncStart');
        const batchSubTable = document.getElementById('batchSubTable');
        const batchDelete = document.getElementById('batchDelete');

        // 存储已选表的数据
        let selectedTables = {};
        // 存储批量选中的表（用于批量操作）
        let batchSelectedTables = new Set();

        // 打开弹窗
        btnAddTable.addEventListener('click', () => {
            modal.classList.add('show');
        });

        // 清空弹窗数据
        function clearModalData() {
            // 清空已选表数据
            selectedTables = {};
            batchSelectedTables.clear();
            
            // 清空左侧所有勾选状态
            document.querySelectorAll('.tree-item .tree-checkbox').forEach(checkbox => {
                checkbox.classList.remove('checked');
            });
            
            // 重置右侧显示状态
            emptyState.style.display = 'flex';
            tableWrapper.style.display = 'none';
            batchActionBar.classList.remove('show');
            selectAllCheckbox.classList.remove('checked');
            selectedTableBody.innerHTML = '';
            
            // 清空搜索框
            const tableSearch = document.getElementById('tableSearch');
            if (tableSearch) {
                tableSearch.value = '';
                // 恢复所有表项的显示
                document.querySelectorAll('.tree-item').forEach(item => {
                    item.style.display = 'flex';
                });
            }
        }

        // 关闭弹窗
        function closeModalFunc() {
            clearModalData();
            modal.classList.remove('show');
        }

        closeModal.addEventListener('click', closeModalFunc);
        btnCancel.addEventListener('click', closeModalFunc);

        // 点击遮罩层关闭
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModalFunc();
            }
        });

        // 分类展开/折叠
        document.querySelectorAll('.tree-category-header').forEach(header => {
            header.addEventListener('click', function() {
                const category = this.parentElement;
                category.classList.toggle('expanded');
                const icon = this.querySelector('.tree-category-icon');
                if (category.classList.contains('expanded')) {
                    icon.classList.remove('fa-caret-right');
                    icon.classList.add('fa-caret-down');
                } else {
                    icon.classList.remove('fa-caret-down');
                    icon.classList.add('fa-caret-right');
                }
            });
        });

        // 左侧表项勾选逻辑
        document.querySelectorAll('.tree-item').forEach(item => {
            const checkbox = item.querySelector('.tree-checkbox');
            checkbox.addEventListener('click', function(e) {
                e.stopPropagation();
                const isChecked = this.classList.toggle('checked');
                const tableName = item.dataset.table;
                const tableType = item.dataset.type;
                const category = item.dataset.category;
                const hasSub = item.dataset.hasSub === 'true';
                const subName = item.dataset.subName || tableName;

                if (isChecked) {
                    // 添加到已选表
                    selectedTables[tableName] = {
                        name: tableName,
                        type: tableType,
                        category: category,
                        hasSub: hasSub,
                        subName: subName,
                        subTableMode: hasSub ? 'sub' : null, // 'sub' 表示以子表输出, 'field' 表示以字段输出
                        syncStart: tableType === '全量表' ? '全量表,无需配置' : '2023-05-23 12:23:20'
                    };
                } else {
                    // 从已选表移除
                    delete selectedTables[tableName];
                }
                updateSelectedTableDisplay();
            });
        });

        // 更新右侧已选表显示
        // 更新批量操作栏状态
        function updateBatchActionBar() {
            const selectedCountNum = batchSelectedTables.size;
            const totalCountNum = Object.keys(selectedTables).length;
            
            if (selectedCountNum > 0) {
                batchActionBar.classList.add('show');
                selectedCount.textContent = selectedCountNum;
                totalCount.textContent = totalCountNum;
                
                // 检查选中表的状态
                let hasIncrementalTable = false;
                let hasSubTable = false;
                
                batchSelectedTables.forEach(tableName => {
                    const table = selectedTables[tableName];
                    if (table) {
                        if (table.type === '增量表') {
                            hasIncrementalTable = true;
                        }
                        if (table.hasSub) {
                            hasSubTable = true;
                        }
                    }
                });
                
                // 更新按钮状态
                if (hasIncrementalTable) {
                    batchSyncStart.classList.remove('disabled');
                } else {
                    batchSyncStart.classList.add('disabled');
                }
                
                if (hasSubTable) {
                    batchSubTable.classList.remove('disabled');
                } else {
                    batchSubTable.classList.add('disabled');
                }
            } else {
                batchActionBar.classList.remove('show');
            }
        }

        function updateSelectedTableDisplay() {
            const tableKeys = Object.keys(selectedTables);
            
            if (tableKeys.length === 0) {
                // 显示空状态
                emptyState.style.display = 'flex';
                tableWrapper.style.display = 'none';
                batchActionBar.classList.remove('show');
                selectAllCheckbox.classList.remove('checked');
                batchSelectedTables.clear();
            } else {
                // 显示已选表
                emptyState.style.display = 'none';
                tableWrapper.style.display = 'block';
                
                // 按分类分组
                const groupedTables = {};
                tableKeys.forEach(key => {
                    const table = selectedTables[key];
                    if (!groupedTables[table.category]) {
                        groupedTables[table.category] = [];
                    }
                    groupedTables[table.category].push(table);
                });

                // 生成表格内容 - 分类和表在同一行显示
                let html = '';
                Object.keys(groupedTables).forEach(category => {
                    const categoryId = 'category-' + category.replace(/\s+/g, '-');
                    const tables = groupedTables[category];
                    const isExpanded = true; // 默认展开
                    
                    // 分类行
                    html += `
                        <tr class="category-row expanded" id="${categoryId}" data-category="${category}">
                            <td style="width: 40px;"></td>
                            <td colspan="5" class="category-label">
                                <i class="fa-solid fa-caret-down expand-icon"></i>
                                分类:${category}
                            </td>
                        </tr>
                    `;
                    
                    // 该分类下的表
                    tables.forEach((table, index) => {
                        const rowId = 'row-' + table.name.replace(/\s+/g, '-');
                        const subTableMode = table.subTableMode || (table.hasSub ? 'sub' : 'field');
                        const isBatchSelected = batchSelectedTables.has(table.name);
                        
                        html += `
                            <tr class="selected-row" id="${rowId}" data-table="${table.name}">
                                <td>
                                    <div class="tree-checkbox row-checkbox ${isBatchSelected ? 'checked' : ''}" data-table="${table.name}"></div>
                                </td>
                                <td>
                                    <i class="fa-solid fa-table" style="color: var(--primary-blue); margin-right: 6px;"></i>
                                    ${table.name}
                                </td>
                                <td>${table.type}</td>
                                <td>
                                    ${table.type === '全量表' 
                                        ? '全量表,无需配置' 
                                        : `<div class="sync-start-input">
                                            <input type="text" value="${table.syncStart}" readonly>
                                            <i class="fa-regular fa-calendar"></i>
                                        </div>`
                                    }
                                </td>
                                <td>
                                    ${table.hasSub 
                                        ? `<span class="sub-table-toggle" data-table="${table.name}">
                                            ${subTableMode === 'sub' ? '以子表输出' : '以字段输出'}
                                            <i class="fa-solid fa-rotate"></i>
                                        </span>`
                                        : '无子表,无需处理'
                                    }
                                </td>
                                <td>
                                    <i class="fa-regular fa-trash-can delete-btn" data-table="${table.name}"></i>
                                </td>
                            </tr>
                        `;
                        
                        // 如果有子表且为子表输出模式，显示子表行
                        if (table.hasSub && subTableMode === 'sub') {
                            html += `
                                <tr class="selected-row sub-row" id="sub-${rowId}">
                                    <td style="position: relative;">
                                        <span class="sub-indicator-line"></span>
                                    </td>
                                    <td style="padding-left: 20px;">
                                        ${table.subName || table.name}
                                    </td>
                                    <td>增量子表</td>
                                    <td>跟随主表</td>
                                    <td></td>
                                    <td></td>
                                </tr>
                            `;
                        }
                    });
                });

                selectedTableBody.innerHTML = html;

                // 绑定分类展开/折叠
                document.querySelectorAll('.category-label').forEach(label => {
                    label.addEventListener('click', function() {
                        const categoryRow = this.closest('.category-row');
                        const isExpanded = categoryRow.classList.toggle('expanded');
                        const category = categoryRow.dataset.category;
                        
                        // 找到该分类下的所有表行（包括子表行）
                        let currentRow = categoryRow.nextElementSibling;
                        while (currentRow) {
                            const tableName = currentRow.dataset.table;
                            if (tableName) {
                                const table = selectedTables[tableName];
                                if (table && table.category === category) {
                                    if (isExpanded) {
                                        currentRow.style.display = '';
                                        // 检查是否有子表行
                                        const subRow = document.getElementById('sub-' + currentRow.id);
                                        if (subRow) subRow.style.display = '';
                                    } else {
                                        currentRow.style.display = 'none';
                                        // 隐藏子表行
                                        const subRow = document.getElementById('sub-' + currentRow.id);
                                        if (subRow) subRow.style.display = 'none';
                                    }
                                    currentRow = currentRow.nextElementSibling;
                                } else {
                                    break; // 遇到其他分类的行，停止
                                }
                            } else if (currentRow.classList.contains('sub-row')) {
                                // 子表行
                                if (isExpanded) {
                                    currentRow.style.display = '';
                                } else {
                                    currentRow.style.display = 'none';
                                }
                                currentRow = currentRow.nextElementSibling;
                            } else {
                                break; // 遇到分类行，停止
                            }
                        }
                    });
                });

                // 绑定子表切换事件
                document.querySelectorAll('.sub-table-toggle').forEach(toggle => {
                    toggle.addEventListener('click', function() {
                        const tableName = this.dataset.table;
                        const table = selectedTables[tableName];
                        if (table) {
                            table.subTableMode = table.subTableMode === 'sub' ? 'field' : 'sub';
                            updateSelectedTableDisplay();
                        }
                    });
                });

                // 绑定删除按钮事件
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const tableName = this.dataset.table;
                        delete selectedTables[tableName];
                        batchSelectedTables.delete(tableName);
                        // 同时取消左侧的勾选
                        document.querySelectorAll('.tree-item').forEach(item => {
                            if (item.dataset.table === tableName) {
                                item.querySelector('.tree-checkbox').classList.remove('checked');
                            }
                        });
                        updateSelectedTableDisplay();
                        updateBatchActionBar();
                    });
                });

                // 绑定右侧表格复选框点击事件（批量选择）
                document.querySelectorAll('.row-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const tableName = this.dataset.table;
                        const isChecked = this.classList.toggle('checked');
                        
                        if (isChecked) {
                            batchSelectedTables.add(tableName);
                        } else {
                            batchSelectedTables.delete(tableName);
                        }
                        
                        updateBatchActionBar();
                        updateSelectAllCheckbox();
                    });
                });
                
                updateSelectAllCheckbox();
                updateBatchActionBar();
            }
        }
        
        // 更新全选复选框状态
        function updateSelectAllCheckbox() {
            const allRows = selectedTableBody.querySelectorAll('.selected-row:not(.category-row):not(.sub-row)');
            const checkedRows = selectedTableBody.querySelectorAll('.row-checkbox.checked');
            if (allRows.length > 0 && allRows.length === checkedRows.length) {
                selectAllCheckbox.classList.add('checked');
            } else {
                selectAllCheckbox.classList.remove('checked');
            }
        }

        // 全选/取消全选
        selectAllCheckbox.addEventListener('click', function() {
            const isChecked = this.classList.toggle('checked');
            const allCheckboxes = selectedTableBody.querySelectorAll('.row-checkbox');
            
            allCheckboxes.forEach(cb => {
                const tableName = cb.dataset.table;
                if (isChecked) {
                    cb.classList.add('checked');
                    batchSelectedTables.add(tableName);
                } else {
                    cb.classList.remove('checked');
                    batchSelectedTables.delete(tableName);
                }
            });
            
            updateBatchActionBar();
        });

        // 批量操作栏关闭
        batchClose.addEventListener('click', function() {
            batchSelectedTables.clear();
            selectedTableBody.querySelectorAll('.row-checkbox').forEach(cb => {
                cb.classList.remove('checked');
            });
            selectAllCheckbox.classList.remove('checked');
            updateBatchActionBar();
        });

        // 批量操作：首次同步起点
        batchSyncStart.addEventListener('click', function() {
            if (this.classList.contains('disabled')) return;
            // TODO: 实现批量设置首次同步起点的逻辑
            alert('批量设置首次同步起点功能待实现');
        });

        // 批量操作：子表处理
        batchSubTable.addEventListener('click', function() {
            if (this.classList.contains('disabled')) return;
            // TODO: 实现批量设置子表处理的逻辑
            alert('批量设置子表处理功能待实现');
        });

        // 批量操作：批量删除
        batchDelete.addEventListener('click', function() {
            if (batchSelectedTables.size === 0) return;
            
            if (confirm(`确定要删除选中的 ${batchSelectedTables.size} 张表吗？`)) {
                batchSelectedTables.forEach(tableName => {
                    delete selectedTables[tableName];
                    // 同时取消左侧的勾选
                    document.querySelectorAll('.tree-item').forEach(item => {
                        if (item.dataset.table === tableName) {
                            item.querySelector('.tree-checkbox').classList.remove('checked');
                        }
                    });
                });
                batchSelectedTables.clear();
                updateSelectedTableDisplay();
            }
        });

        // 搜索功能 - 同时搜索左右两边的表
        const tableSearch = document.getElementById('tableSearch');
        tableSearch.addEventListener('input', function() {
            const searchText = this.value.toLowerCase().trim();
            
            // 搜索左侧的表列表
            document.querySelectorAll('.tree-item').forEach(item => {
                const tableName = item.dataset.table.toLowerCase();
                if (searchText === '' || tableName.includes(searchText)) {
                    item.style.display = 'flex';
                    // 显示父分类
                    let category = item.closest('.tree-category');
                    if (category) {
                        category.classList.add('expanded');
                        category.querySelector('.tree-category-icon').classList.remove('fa-caret-right');
                        category.querySelector('.tree-category-icon').classList.add('fa-caret-down');
                    }
                } else {
                    item.style.display = 'none';
                }
            });
            
            // 搜索右侧的已选表列表
            if (selectedTableBody) {
                selectedTableBody.querySelectorAll('.selected-row').forEach(row => {
                    // 跳过分类行和子表行
                    if (row.classList.contains('category-row') || row.classList.contains('sub-row')) {
                        return;
                    }
                    
                    const tableName = row.dataset.table;
                    if (tableName) {
                        const tableNameLower = tableName.toLowerCase();
                        const matches = searchText === '' || tableNameLower.includes(searchText);
                        
                        if (matches) {
                            row.style.display = '';
                            // 如果有子表行，也显示
                            const subRow = document.getElementById('sub-' + row.id);
                            if (subRow) {
                                subRow.style.display = '';
                            }
                        } else {
                            row.style.display = 'none';
                            // 隐藏子表行
                            const subRow = document.getElementById('sub-' + row.id);
                            if (subRow) {
                                subRow.style.display = 'none';
                            }
                        }
                    }
                });
                
                // 处理分类行的显示/隐藏
                selectedTableBody.querySelectorAll('.category-row').forEach(categoryRow => {
                    const category = categoryRow.dataset.category;
                    // 检查该分类下是否有匹配的表
                    let hasVisibleTable = false;
                    let currentRow = categoryRow.nextElementSibling;
                    while (currentRow) {
                        if (currentRow.classList.contains('category-row')) {
                            break; // 遇到下一个分类，停止
                        }
                        if (!currentRow.classList.contains('sub-row')) {
                            const tableName = currentRow.dataset.table;
                            if (tableName) {
                                const table = selectedTables[tableName];
                                if (table && table.category === category) {
                                    const tableNameLower = tableName.toLowerCase();
                                    if (searchText === '' || tableNameLower.includes(searchText)) {
                                        hasVisibleTable = true;
                                        break;
                                    }
                                }
                            }
                        }
                        currentRow = currentRow.nextElementSibling;
                    }
                    
                    // 如果该分类下没有可见的表，隐藏分类行
                    categoryRow.style.display = hasVisibleTable || searchText === '' ? '' : 'none';
                });
            }
        });
    </script>
</body>
</html>